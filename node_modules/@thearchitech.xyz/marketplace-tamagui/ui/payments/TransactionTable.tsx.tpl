// Transaction Table Component for Tamagui

import React from 'react';
import { YStack, XStack, Button, Text, Card, CardContent, Theme, Square } from '@tamagui/core';
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';
import { Badge } from '@tamagui/core';
import { useTranslation } from '@/lib/i18n/client';
import { 
  Eye, 
  Download,
  CheckCircle,
  XCircle,
  Clock,
  AlertCircle
} from '@tamagui/lucide-icons';

interface TransactionTableProps {
  transactions: Array<{
    id: string;
    status: 'succeeded' | 'pending' | 'failed' | 'cancelled' | 'requires_action';
    type: 'payment' | 'refund' | 'chargeback' | 'adjustment';
    amount: number;
    currency: string;
    description?: string;
    customerName?: string;
    customerEmail?: string;
    createdAt: string;
    metadata?: Record<string, any>;
  }>;
  onTransactionClick?: (transaction: any) => void;
  onDownload?: (transaction: any) => void;
  getStatusBadge: (status: string) => React.ReactNode;
  getTypeIcon: (type: string) => React.ReactNode;
}

export const TransactionTable: React.FC<TransactionTableProps> = ({
  transactions,
  onTransactionClick,
  onDownload,
  getStatusBadge,
  getTypeIcon,
}) => {
  const { t } = useTranslation();
  
  const formatDate = (dateString: string) => {
    return new Date(dateString).toLocaleDateString('en-US', {
      year: 'numeric',
      month: 'short',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit',
    });
  };

  const formatCurrency = (amount: number, currency: string = 'USD') => {
    return new Intl.NumberFormat('en-US', {
      style: 'currency',
      currency: currency,
    }).format(amount);
  };

  const getAmountColor = (type: string, amount: number) => {
    if (type === 'refund' || type === 'chargeback') {
      return '$red10';
    }
    if (amount < 0) {
      return '$red10';
    }
    return '$green10';
  };

  // Custom table implementation for Tamagui
  return (
    <YStack width="100%" overflow="hidden">
      {/* Table Header */}
      <XStack 
        backgroundColor="$gray3" 
        padding="$3" 
        borderBottomWidth={1} 
        borderBottomColor="$gray5"
      >
        <Text flex={0.5} fontWeight="bold" fontSize="$2">{t('payments.transaction.id')}</Text>
        <Text flex={0.7} fontWeight="bold" fontSize="$2">{t('payments.transaction.type')}</Text>
        <Text flex={1} fontWeight="bold" fontSize="$2">{t('payments.transaction.customer')}</Text>
        <Text flex={1.5} fontWeight="bold" fontSize="$2">{t('payments.transaction.description')}</Text>
        <Text flex={0.8} fontWeight="bold" fontSize="$2">{t('payments.transaction.amount')}</Text>
        <Text flex={0.8} fontWeight="bold" fontSize="$2">{t('payments.transaction.status')}</Text>
        <Text flex={1} fontWeight="bold" fontSize="$2">{t('payments.transaction.date')}</Text>
        <Text flex={0.8} fontWeight="bold" fontSize="$2" textAlign="right">{t('payments.transaction.actions')}</Text>
      </XStack>

      {/* Table Rows */}
      {transactions.map((transaction) => (
        <XStack 
          key={transaction.id}
          padding="$3" 
          borderBottomWidth={1} 
          borderBottomColor="$gray5"
          hoverStyle={{ backgroundColor: '$gray2' }}
        >
          {/* ID */}
          <YStack flex={0.5}>
            <Text fontFamily="$mono" fontSize="$1">
              {transaction.id.substring(0, 8)}...
            </Text>
          </YStack>
          
          {/* Type */}
          <YStack flex={0.7}>
            <XStack alignItems="center" gap="$2">
              {getTypeIcon(transaction.type)}
              <Text fontSize="$2" textTransform="capitalize">
                {transaction.type.replace('_', ' ')}
              </Text>
            </XStack>
          </YStack>
          
          {/* Customer */}
          <YStack flex={1}>
            {transaction.customerName ? (
              <YStack>
                <Text fontWeight="500" fontSize="$2">{transaction.customerName}</Text>
                {transaction.customerEmail && (
                  <Text fontSize="$1" color="$gray10">{transaction.customerEmail}</Text>
                )}
              </YStack>
            ) : (
              <Text fontSize="$2" color="$gray10">{t('payments.transaction.notAvailable')}</Text>
            )}
          </YStack>
          
          {/* Description */}
          <YStack flex={1.5}>
            <Text fontSize="$2" numberOfLines={1} ellipsizeMode="tail">
              {transaction.description || t('payments.transaction.noDescription')}
            </Text>
          </YStack>
          
          {/* Amount */}
          <YStack flex={0.8}>
            <Text fontWeight="500" color={getAmountColor(transaction.type, transaction.amount)}>
              {formatCurrency(transaction.amount, transaction.currency)}
            </Text>
          </YStack>
          
          {/* Status */}
          <YStack flex={0.8}>
            {getStatusBadge(transaction.status)}
          </YStack>
          
          {/* Date */}
          <YStack flex={1}>
            <Text fontSize="$2">{formatDate(transaction.createdAt)}</Text>
          </YStack>
          
          {/* Actions */}
          <YStack flex={0.8} alignItems="flex-end">
            <XStack gap="$2">
              <Button
                size="$2"
                variant="outlined"
                onPress={() => onTransactionClick?.(transaction)}
                icon={<Eye size={16} />}
              />
              
              <Button
                size="$2"
                variant="outlined"
                onPress={() => onDownload?.(transaction)}
                icon={<Download size={16} />}
              />
            </XStack>
          </YStack>
        </XStack>
      ))}
      
      {/* Empty State */}
      {transactions.length === 0 && (
        <YStack padding="$6" alignItems="center" justifyContent="center">
          <Theme name="gray">
            <Square size="$6" marginBottom="$4">
              <CheckCircle size={48} color="$gray8" />
            </Square>
          </Theme>
          <Text fontSize="$5" fontWeight="500" marginBottom="$2">{t('payments.transaction.noTransactionsTitle')}</Text>
          <Text color="$gray10">{t('payments.transaction.noTransactionsDesc')}</Text>
        </YStack>
      )}
    </YStack>
  );
};
