// Payment Method Selector Component

import React from 'react';
import { useTranslation } from '@/lib/i18n';
import { 
  CreditCard, 
  Smartphone, 
  Building2, 
  Wallet,
  Check
} from 'lucide-react-native';

import {
  YStack,
  XStack,
  Card,
  CardContent,
  Badge,
  Label,
  Text,
  RadioGroup,
  Theme,
  Square
} from 'tamagui';

interface PaymentMethod {
  id: string;
  name: string;
  description: string;
  icon: React.ComponentType<{ size?: number; color?: string }>;
  enabled: boolean;
  badge?: string;
}

interface PaymentMethodSelectorProps {
  value: string;
  onChange: (value: string) => void;
  methods?: PaymentMethod[];
}

const defaultMethods: PaymentMethod[] = [
  {
    id: 'card',
    name: 'Credit/Debit Card',
    description: 'Pay with Visa, Mastercard, American Express',
    icon: CreditCard,
    enabled: true,
  },
  {
    id: 'apple_pay',
    name: 'Apple Pay',
    description: 'Pay securely with Apple Pay',
    icon: Smartphone,
    enabled: true,
    badge: 'Recommended',
  },
  {
    id: 'google_pay',
    name: 'Google Pay',
    description: 'Pay securely with Google Pay',
    icon: Smartphone,
    enabled: true,
  },
  {
    id: 'bank_transfer',
    name: 'Bank Transfer',
    description: 'Direct bank transfer (ACH)',
    icon: Building2,
    enabled: true,
  },
  {
    id: 'wallet',
    name: 'Digital Wallet',
    description: 'Pay with your digital wallet',
    icon: Wallet,
    enabled: false,
  },
];

export function PaymentMethodSelector({
  value,
  onChange,
  methods = defaultMethods,
}: PaymentMethodSelectorProps) {
  const { t } = useTranslation();
  const enabledMethods = methods.filter(method => method.enabled);

  return (
    <YStack space="$4">
      <RadioGroup value={value} onValueChange={onChange}>
        {enabledMethods.map((method) => {
          const Icon = method.icon;
          const isSelected = value === method.id;

          return (
            <YStack key={method.id} position="relative">
              <XStack
                alignItems="center"
                gap="$3"
                padding="$4"
                borderWidth={1}
                borderColor={isSelected ? "$blue8" : "$borderColor"}
                backgroundColor={isSelected ? "$blue2" : "transparent"}
                borderRadius="$3"
                pressStyle={{
                  backgroundColor: isSelected ? "$blue2" : "$backgroundHover"
                }}
                onPress={() => onChange(method.id)}
              >
                <XStack 
                  width={20} 
                  height={20} 
                  borderRadius="$full" 
                  borderWidth={2}
                  borderColor={isSelected ? "$blue9" : "$gray8"}
                  backgroundColor={isSelected ? "$blue9" : "transparent"}
                  alignItems="center" 
                  justifyContent="center"
                >
                  {isSelected && (
                    <Check size={12} color="white" />
                  )}
                </XStack>

                <Theme name={isSelected ? "blue" : "gray"}>
                  <YStack
                    padding="$2"
                    borderRadius="$2"
                    backgroundColor="$background"
                  >
                    <Icon 
                      size={20} 
                      color={isSelected ? "$blue10" : "$gray10"} 
                    />
                  </YStack>
                </Theme>

                <YStack flex={1} minWidth={0}>
                  <XStack alignItems="center" gap="$2">
                    <Text 
                      fontWeight="$6" 
                      fontSize="$3"
                      color={isSelected ? "$blue11" : "$color"}
                    >
                      {t(`payments.methods.${method.id}.name`, method.name)}
                    </Text>
                    {method.badge && (
                      <Badge variant="outline" size="$1">
                        <Text fontSize="$1">
                          {t(`payments.methods.${method.id}.badge`, method.badge)}
                        </Text>
                      </Badge>
                    )}
                  </XStack>
                  <Text 
                    fontSize="$2" 
                    color={isSelected ? "$blue9" : "$colorFocus"}
                  >
                    {t(`payments.methods.${method.id}.description`, method.description)}
                  </Text>
                </YStack>
              </XStack>
            </YStack>
          );
        })}
      </RadioGroup>

      {enabledMethods.length === 0 && (
        <YStack alignItems="center" justifyContent="center" paddingVertical="$8">
          <CreditCard size={48} color="$gray8" />
          <Text fontWeight="$6" fontSize="$5" marginTop="$4" marginBottom="$2">
            {t('payments.noMethodsAvailable')}
          </Text>
          <Text color="$colorFocus">
            {t('payments.contactSupportForMethods')}
          </Text>
        </YStack>
      )}
    </YStack>
  );
}
