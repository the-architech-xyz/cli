/**
 * Webhook Handler Component
 * 
 * Simple webhook event display and management
 */

'use client';

import { useState } from 'react';
import { 
  YStack, 
  XStack, 
  Button, 
  Text,
  Card,
  CardHeader,
  CardContent,
  Badge,
  Theme,
  Square,
  ScrollView
} from 'tamagui';
import { CheckCircle, XCircle, Clock } from 'lucide-react-native';
import { useWebhookEvents } from '@/lib/payments/hooks';
import { useTranslation } from '@/lib/i18n';

export function WebhookHandler() {
  const { t } = useTranslation();
  const { data: events, isLoading } = useWebhookEvents();
  const [selectedEvent, setSelectedEvent] = useState<any>(null);

  if (isLoading) {
    return <Text>{t('payments.webhooks.loading')}</Text>;
  }

  return (
    <YStack space="$4">
      <Card elevate>
        <CardHeader>
          <Text fontSize="$5" fontWeight="$6">
            {t('payments.webhooks.title')}
          </Text>
          <Text fontSize="$2" color="$gray11">
            {t('payments.webhooks.description')}
          </Text>
        </CardHeader>
        <CardContent>
          <YStack space="$2">
            {events?.map((event: any) => (
              <XStack
                key={event.id}
                alignItems="center"
                justifyContent="space-between"
                padding="$3"
                borderWidth={1}
                borderColor="$borderColor"
                borderRadius="$4"
                backgroundColor="$background"
                pressStyle={{ backgroundColor: "$backgroundHover" }}
                hoverStyle={{ backgroundColor: "$backgroundHover" }}
                onPress={() => setSelectedEvent(event)}
              >
                <XStack alignItems="center" gap="$3">
                  {event.status === 'succeeded' && (
                    <CheckCircle size={16} color="$green10" />
                  )}
                  {event.status === 'failed' && (
                    <XCircle size={16} color="$red10" />
                  )}
                  {event.status === 'pending' && (
                    <Clock size={16} color="$yellow10" />
                  )}
                  
                  <YStack>
                    <Text fontSize="$2" fontWeight="$5">
                      {event.type}
                    </Text>
                    <Text fontSize="$1" color="$gray10">
                      {new Date(event.created).toLocaleString()}
                    </Text>
                  </YStack>
                </XStack>
                
                <Badge
                  theme={
                    event.status === 'succeeded' ? "green" :
                    event.status === 'failed' ? "red" :
                    "yellow"
                  }
                >
                  {event.status}
                </Badge>
              </XStack>
            ))}
          </YStack>
        </CardContent>
      </Card>

      {selectedEvent && (
        <Card elevate>
          <CardHeader>
            <Text fontSize="$5" fontWeight="$6">
              {t('payments.webhooks.eventDetails')}
            </Text>
            <Text fontSize="$2" color="$gray11">
              {t('payments.webhooks.rawEventData')}
            </Text>
          </CardHeader>
          <CardContent>
            <ScrollView 
              horizontal={false}
              backgroundColor="$gray2" 
              padding="$4" 
              borderRadius="$4"
              height={200}
            >
              <Text fontSize="$1" fontFamily="$mono" whiteSpace="pre">
                {JSON.stringify(selectedEvent, null, 2)}
              </Text>
            </ScrollView>
          </CardContent>
        </Card>
      )}
    </YStack>
  );
}

