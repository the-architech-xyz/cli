'use client';

import { useEffect, useState } from 'react';
import { useRouter } from 'next/navigation';
import { useAuth } from '@/lib/auth/hooks';
import { useTranslation } from '@/lib/i18n';
import { 
  YStack, 
  Text,
  Spinner
} from 'tamagui';

interface AuthGuardProps {
  children: React.ReactNode;
  fallback?: React.ReactNode;
  redirectTo?: string;
  requireAuth?: boolean;
}

export default function AuthGuard({ 
  children, 
  fallback, 
  redirectTo = '/login',
  requireAuth = true 
}: AuthGuardProps) {
  const { t } = useTranslation();
  const { user, isLoading } = useAuth();
  const router = useRouter();
  const [isChecking, setIsChecking] = useState(true);

  useEffect(() => {
    if (!isLoading) {
      if (requireAuth && !user) {
        router.push(redirectTo);
      } else if (!requireAuth && user) {
        router.push('/dashboard');
      } else {
        setIsChecking(false);
      }
    }
  }, [user, isLoading, requireAuth, redirectTo, router]);

  if (isLoading || isChecking) {
    return fallback || (
      <YStack alignItems="center" justifyContent="center" minHeight="100vh">
        <Spinner size="large" color="$accent10" />
      </YStack>
    );
  }

  if (requireAuth && !user) {
    return fallback || (
      <YStack alignItems="center" justifyContent="center" minHeight="100vh">
        <YStack alignItems="center">
          <Text fontSize="$5" fontWeight="bold">
            {t('auth.accessDenied')}
          </Text>
          <Text color="$gray10">
            {t('auth.pleaseLogIn')}
          </Text>
        </YStack>
      </YStack>
    );
  }

  if (!requireAuth && user) {
    return null; // Will redirect in useEffect
  }

  return <>{children}</>;
}


