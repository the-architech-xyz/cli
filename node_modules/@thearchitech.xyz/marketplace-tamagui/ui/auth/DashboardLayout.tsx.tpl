/**
 * Dashboard Layout Component (Tamagui)
 * 
 * Main dashboard layout with i18n support
 */

import React, { ReactNode, useState } from 'react';
import { YStack, XStack, Button, Text, Input, Card, Sheet, Avatar } from 'tamagui';
import { useAuth } from '@/hooks/use-auth';
import { useTranslation } from '@/lib/i18n';
import { 
  LayoutDashboard, 
  Users, 
  Settings, 
  LogOut, 
  Menu, 
  X,
  Bell,
  Search
} from '@tamagui/lucide-icons';

interface DashboardLayoutProps {
  children: ReactNode;
  title?: string;
}

export function DashboardLayout({ children, title = "Dashboard" }: DashboardLayoutProps) {
  const { t } = useTranslation();
  const { user, logout } = useAuth();
  const [sidebarOpen, setSidebarOpen] = useState(false);

  const navigation = [
    { name: t('dashboard.navigation.dashboard'), href: '/dashboard', icon: LayoutDashboard },
    { name: t('dashboard.navigation.users'), href: '/users', icon: Users },
    { name: t('dashboard.navigation.settings'), href: '/settings', icon: Settings },
  ];

  return (
    <YStack flex={1} backgroundColor="$gray2" minHeight="100vh">
      {/* Mobile sidebar */}
      <Sheet
        modal
        open={sidebarOpen}
        onOpenChange={setSidebarOpen}
        snapPoints={[80]}
        position={0}
        dismissOnSnapToBottom
      >
        <Sheet.Overlay 
          backgroundColor="$gray12" 
          opacity={0.7} 
          onPress={() => setSidebarOpen(false)}
        />
        <Sheet.Frame
          backgroundColor="$background"
          width={250}
          borderTopRightRadius="$4"
          borderBottomRightRadius="$4"
        >
          <YStack flex={1}>
            <XStack height="$4" alignItems="center" justifyContent="space-between" paddingHorizontal="$4">
              <Text fontSize="$6" fontWeight="bold" color="$color">
                {t('dashboard.title')}
              </Text>
              <Button
                size="$3"
                backgroundColor="transparent"
                onPress={() => setSidebarOpen(false)}
              >
                <X size="$1" color="$color" />
              </Button>
            </XStack>
            
            <YStack padding="$4" gap="$2" flex={1}>
              {navigation.map((item) => {
                const Icon = item.icon;
                return (
                  <Button
                    key={item.name}
                    size="$4"
                    backgroundColor="transparent"
                    justifyContent="flex-start"
                    onPress={() => {
                      window.location.href = item.href;
                      setSidebarOpen(false);
                    }}
                  >
                    <XStack gap="$3" alignItems="center">
                      <Icon size="$1" color="$color" />
                      <Text fontSize="$4" color="$color">
                        {item.name}
                      </Text>
                    </XStack>
                  </Button>
                );
              })}
            </YStack>
          </YStack>
        </Sheet.Frame>
      </Sheet>

      {/* Desktop sidebar */}
      <XStack width="100%" flex={1}>
        <YStack
          width={250}
          backgroundColor="$background"
          borderRightWidth={1}
          borderColor="$borderColor"
          display={{ base: 'none', md: 'flex' }}
        >
          <XStack height="$4" alignItems="center" paddingHorizontal="$4">
            <Text fontSize="$6" fontWeight="bold" color="$color">
              {t('dashboard.title')}
            </Text>
          </XStack>
          
          <YStack padding="$4" gap="$2" flex={1}>
            {navigation.map((item) => {
              const Icon = item.icon;
              return (
                <Button
                  key={item.name}
                  size="$4"
                  backgroundColor="transparent"
                  justifyContent="flex-start"
                  onPress={() => window.location.href = item.href}
                >
                  <XStack gap="$3" alignItems="center">
                    <Icon size="$1" color="$color" />
                    <Text fontSize="$4" color="$color">
                      {item.name}
                    </Text>
                  </XStack>
                </Button>
              );
            })}
          </YStack>
        </YStack>

        {/* Main content */}
        <YStack flex={1}>
          {/* Top bar */}
          <XStack
            height="$4"
            backgroundColor="$background"
            borderBottomWidth={1}
            borderColor="$borderColor"
            paddingHorizontal="$4"
            alignItems="center"
            justifyContent="space-between"
            position="sticky"
            top={0}
            zIndex={10}
            elevation="$1"
          >
            <XStack alignItems="center" gap="$4" flex={1}>
              <Button
                size="$3"
                backgroundColor="transparent"
                onPress={() => setSidebarOpen(true)}
                display={{ md: 'none' }}
              >
                <Menu size="$1" color="$color" />
              </Button>

              <XStack position="relative" flex={1} maxWidth={400}>
                <Search 
                  size="$1" 
                  color="$colorFocus" 
                  position="absolute" 
                  left="$3" 
                  top="50%" 
                  transform="translateY(-50%)" 
                />
                <Input
                  flex={1}
                  placeholder={t('dashboard.search')}
                  paddingLeft="$8"
                  backgroundColor="$background"
                  color="$color"
                  borderWidth={1}
                  borderColor="$borderColor"
                  borderRadius="$4"
                />
              </XStack>
            </XStack>
            
            <XStack alignItems="center" gap="$4">
              <Button
                size="$3"
                backgroundColor="transparent"
                onPress={() => console.log('Notifications')}
              >
                <Bell size="$1" color="$color" />
              </Button>
              
              <XStack alignItems="center" gap="$2">
                <Avatar circular size="$3" backgroundColor="$blue10">
                  <Avatar.Fallback>
                    <Text color="white" fontSize="$3" fontWeight="bold">
                      {user?.name?.charAt(0) || user?.email?.charAt(0) || 'U'}
                    </Text>
                  </Avatar.Fallback>
                </Avatar>
                
                <YStack display={{ base: 'none', md: 'flex' }}>
                  <Text fontSize="$3" fontWeight="bold" color="$color">
                    {user?.name || t('dashboard.user')}
                  </Text>
                  <Text fontSize="$2" color="$colorFocus">
                    {user?.email}
                  </Text>
                </YStack>
              </XStack>
              
              <Button
                size="$3"
                backgroundColor="transparent"
                onPress={logout}
              >
                <LogOut size="$1" color="$color" />
              </Button>
            </XStack>
          </XStack>

          {/* Page content */}
          <YStack padding="$6" maxWidth={1200} marginHorizontal="auto" width="100%">
            <Text fontSize="$7" fontWeight="bold" color="$color" marginBottom="$4">
              {title}
            </Text>
            {children}
          </YStack>
        </YStack>
      </XStack>
    </YStack>
  );
}

export default DashboardLayout;

