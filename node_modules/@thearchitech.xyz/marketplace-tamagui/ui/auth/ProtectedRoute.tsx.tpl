import { ReactNode } from 'react';
import { useTranslation } from '@/lib/i18n';
import { useAuth } from '@/lib/auth/hooks';
import AuthGuard from './AuthGuard';
import { YStack, Text } from 'tamagui';

interface ProtectedRouteProps {
  children: ReactNode;
  fallback?: ReactNode;
  redirectTo?: string;
  roles?: string[];
  permissions?: string[];
}

export default function ProtectedRoute({ 
  children, 
  fallback,
  redirectTo = '/unauthorized',
  roles = [],
  permissions = []
}: ProtectedRouteProps) {
  const { t } = useTranslation();
  const { user } = useAuth();

  // Check if user has required roles
  const hasRequiredRole = roles.length === 0 || 
    (user && roles.some(role => user.roles?.includes(role)));

  // Check if user has required permissions
  const hasRequiredPermissions = permissions.length === 0 || 
    (user && permissions.every(permission => user.permissions?.includes(permission)));

  const isAuthorized = hasRequiredRole && hasRequiredPermissions;

  if (!isAuthorized) {
    return fallback || (
      <YStack alignItems="center" justifyContent="center" minHeight="100vh">
        <YStack alignItems="center">
          <Text fontSize="$5" fontWeight="bold">
            {t('auth.unauthorized')}
          </Text>
          <Text color="$gray10">
            {t('auth.noPermission')}
          </Text>
        </YStack>
      </YStack>
    );
  }

  return (
    <AuthGuard requireAuth={true} redirectTo={redirectTo}>
      {children}
    </AuthGuard>
  );
}


