/**
 * Team Settings Page
 * 
 * Simple team settings management interface
 */

'use client';

import { useState } from 'react';
import { useTranslation } from '@/lib/i18n';
import { useTeam, useUpdateTeam } from '@/lib/teams/hooks';
import { useToast } from '@/components/ui/use-toast';

import {
  YStack,
  XStack,
  Card,
  CardContent,
  CardDescription,
  CardHeader,
  CardTitle,
  Button,
  Input,
  Label,
  TextArea,
  Text,
  Spinner
} from 'tamagui';

export function TeamSettingsPage({ teamId }: { teamId: string }) {
  const { t } = useTranslation();
  const { data: team, isLoading } = useTeam(teamId);
  const updateTeam = useUpdateTeam();
  const { toast } = useToast();
  
  const [name, setName] = useState(team?.name || '');
  const [description, setDescription] = useState(team?.description || '');

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    
    try {
      await updateTeam.mutateAsync({
        id: teamId,
        name,
        description,
      });
      
      toast({
        title: t('teams.settings.updateSuccess'),
        description: t('teams.settings.updateSuccessDescription'),
      });
    } catch (error) {
      toast({
        title: t('teams.settings.updateFailed'),
        description: error instanceof Error ? error.message : t('teams.settings.updateFailedDescription'),
        variant: 'destructive',
      });
    }
  };

  if (isLoading) {
    return (
      <YStack padding="$6" alignItems="center" justifyContent="center" height={200}>
        <Spinner size="large" />
        <Text marginTop="$4" color="$colorFocus">
          {t('teams.settings.loading')}
        </Text>
      </YStack>
    );
  }

  return (
    <Card elevate>
      <CardHeader>
        <CardTitle>{t('teams.settings.title')}</CardTitle>
        <CardDescription>{t('teams.settings.basicInfoDescription')}</CardDescription>
      </CardHeader>
      <CardContent>
        <YStack space="$4" as="form" onSubmit={handleSubmit}>
          <YStack space="$2">
            <Label htmlFor="name">{t('teams.settings.teamName')}</Label>
            <Input
              id="name"
              value={name}
              onChangeText={setName}
              placeholder={t('teams.settings.teamNamePlaceholder')}
            />
          </YStack>
          
          <YStack space="$2">
            <Label htmlFor="description">{t('teams.settings.description')}</Label>
            <TextArea
              id="description"
              value={description}
              onChangeText={setDescription}
              placeholder={t('teams.settings.descriptionPlaceholder')}
              numberOfLines={4}
              minHeight={100}
            />
          </YStack>
          
          <Button 
            theme="blue"
            disabled={updateTeam.isPending}
            onPress={handleSubmit}
          >
            {updateTeam.isPending ? t('teams.settings.saving') : t('teams.settings.saveChanges')}
          </Button>
        </YStack>
      </CardContent>
    </Card>
  );
}
