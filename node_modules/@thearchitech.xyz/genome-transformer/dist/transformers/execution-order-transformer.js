import { BaseGenomeTransformer } from '../core/genome-transformer.js';
/**
 * ExecutionOrderTransformer
 *
 * Provides a stable module ordering so the CLI can execute modules without its own planner/graph.
 * Simple deterministic order: adapters -> connectors -> features. Keeps relative order within groups.
 */
export class ExecutionOrderTransformer extends BaseGenomeTransformer {
    name = 'Execution Order';
    priority = 98; // Before FinalValidator (which is 99)
    description = 'Orders modules deterministically for execution (adapters -> connectors -> features)';
    canTransform(_genome) {
        return true;
    }
    async transform(genome, context) {
        this.logStep(context, 'Ordering modules for execution', { modules: genome.modules.length });
        const adapters = [];
        const connectors = [];
        const features = [];
        const others = [];
        for (const mod of genome.modules) {
            const id = mod.id || '';
            if (id.startsWith('connectors/')) {
                connectors.push(mod);
            }
            else if (id.startsWith('features/')) {
                features.push(mod);
            }
            else {
                adapters.push(mod);
            }
        }
        const ordered = [...adapters, ...connectors, ...features, ...others];
        this.logSuccess(context, 'Modules ordered', { ordered: ordered.length });
        return { ...genome, modules: ordered };
    }
}
//# sourceMappingURL=execution-order-transformer.js.map